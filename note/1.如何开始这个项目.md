如何使用这个项目（只从这里的代码构建），如何打包发布，以及是否有现有的测试代码。


## 如何使用项目（从代码构建）

### 前置依赖

1. **Rust 工具链**：项目会自动下载（通过 `rust-toolchain.toml`，当前版本 1.92.0）
2. **protoc**：Protocol Buffers 编译器
   ```bash
   # Ubuntu/Debian
   sudo apt-get install protobuf-compiler
   
   # 验证安装
   protoc --version
   ```

### 主要构建命令

项目使用 `cargo xtask` 作为构建系统（无需额外安装，项目自带）：

```bash
# 格式化代码、构建、测试和运行 clippy（完整流程）
cargo xtask

# 单独执行各项操作
cargo xtask format      # 格式化代码
cargo xtask build        # 构建（debug 模式）
cargo xtask build --release  # 构建（release 模式）
cargo xtask test         # 运行测试
cargo xtask clippy       # 运行 Clippy 检查

# 运行 Zellij（调试模式）
cargo xtask run
cargo xtask run -l strider  # 使用指定布局运行

# 安装到指定目录
cargo xtask install /path/to/zellij/binary
```

### 构建流程说明

根据 `xtask/src/build.rs`，构建过程包括：
1. 编译 protobuf 定义文件（插件 API、客户端-服务器 IPC、Web 服务器）
2. 构建所有 workspace 成员（包括默认插件）
3. Release 模式下将插件移动到 assets 目录

## 如何打包发布

### 1. 创建发布包（Distribution）

```bash
# 创建发布包到 target/dist 目录
cargo xtask dist
```

这会执行：
- 构建 release 版本的插件和主程序
- 生成 manpage
- 将所有文件打包到 `target/dist/` 目录，包括：
  - `zellij` 可执行文件
  - `man/zellij.1` manpage
  - `zellij.desktop` 桌面文件
  - `logo.png` 图标

### 2. 安装到系统

```bash
# 安装到指定路径
cargo xtask install /usr/local/bin/zellij
```

### 3. 发布到 crates.io

```bash
# 发布所有 crate（需要先配置 cargo 认证）
cargo xtask publish

# 干运行（不实际发布）
cargo xtask publish --dry-run
```

发布流程（见 `xtask/src/pipelines.rs`）：
1. 清理项目
2. 构建 release 版本的插件
3. 更新默认配置
4. 创建 git commit 和 tag
5. 推送代码和 tag（除非使用 `--no-push`）
6. 依次发布所有 crate 到 crates.io

## 测试代码

### 单元测试

项目包含多个测试文件，主要分布在：

- `zellij-utils/src/ipc/tests/` - IPC 相关测试
- `zellij-utils/src/input/unit/` - 输入配置测试（theme_test.rs, layout_test.rs, keybinds_test.rs）
- `zellij-server/src/unit/` - 服务器单元测试
- `zellij-server/src/tab/unit/` - Tab 相关测试
- `zellij-server/src/panes/unit/` - 面板相关测试

运行测试：

```bash
# 运行所有测试
cargo xtask test

# 运行特定测试
cargo test --package zellij-server --lib

# 运行测试并传递参数
cargo xtask test -- --test-threads=1
```

### 端到端测试（E2E Tests）

项目包含端到端测试，通过 Docker 容器运行：

```bash
# 1. 启动 Docker 容器
docker-compose up -d

# 2. 构建 Linux 可执行文件（用于容器测试）
cargo xtask ci e2e --build

# 3. 运行端到端测试
cargo xtask ci e2e --test
```

**注意**：E2E 测试需要：
- `docker` 或 `podman`
- `docker-compose`
- `pkg-config` 和 `openssl`（用于某些测试）

### 测试相关配置

测试运行时会：
1. 先构建所有插件（`plugins_only: true`）
2. 然后对每个 workspace 成员运行 `cargo test`
3. 插件测试使用 `wasm32-wasip1` target

## 其他有用命令

```bash
# 生成 manpage
cargo xtask manpage

# 查看所有可用命令
cargo xtask --help

# 快捷方式（xtask 可简写为 x）
cargo x build
cargo x test
cargo x run
```

## 项目结构说明

- `xtask/` - 自定义构建任务
- `zellij-client/` - 客户端代码
- `zellij-server/` - 服务器代码
- `zellij-utils/` - 工具库
- `default-plugins/` - 默认插件
- `assets/` - 资源文件（布局、配置、插件等）

以上信息基于项目代码和文档整理。