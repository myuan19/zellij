## 序列化间隔设置逻辑

### 基本机制
- 默认值：60 秒（60000 毫秒）
- 配置单位：秒（代码中转换为毫秒）
- 检查频率：后台任务每 1 秒检查一次是否到达序列化时间
- 触发条件：距离上次序列化的时间 ≥ `serialization_interval`

### 设置为 0 的后果
- 几乎每次循环（约每秒）都会触发序列化
- 导致频繁的磁盘 I/O 和 CPU 占用
- 可能影响性能
- 代码未做最小值校验，但不建议设为 0

### 建议值
- 最小建议：1-5 秒（平衡实时性与性能）
- 默认：60 秒
- 可根据需求调整，但避免过小

---

## 序列化行数的含义

### `scrollback_lines_to_serialize`（序列化行数）
- 含义：每次序列化时保存的历史行数
- 作用：控制恢复会话时能从磁盘恢复多少行历史记录
- 默认值：10000 行（如果未设置）

### 序列化内容
- 从 `lines_above` 的末尾取最后 N 行（N = `scrollback_lines_to_serialize`）
- 加上当前 `viewport` 的所有行
- 序列化为一个完整的字符串快照

### 重叠问题
- 相邻两次序列化会有重叠（例如 T0 保存 0-10000 行，T60 保存 6000-16000 行）
- 重叠不影响功能，因为：
  - 每次序列化是完整快照，不是增量追加
  - 恢复时只使用最后一次序列化的完整内容
  - 文件会被覆盖，不会累积

### 特殊值
- `0`：序列化所有可用的历史行（从最开始）
- 大于可用行数：序列化所有可用的历史行
- 正常值：序列化最后 N 行

---

## 两个相关但不同的概念

### 1. `scroll_buffer_size`（运行时回滚大小）
- 控制终端运行时可以往上翻页看到多少行
- 默认：10000 行
- 作用：限制内存中保存的历史行数上限

### 2. `scrollback_lines_to_serialize`（序列化行数）
- 控制恢复会话时从磁盘恢复多少行历史记录
- 默认：10000 行（如果未设置）
- 作用：决定保存到磁盘的历史行数

### 关系
- 两者独立，但通常 `scrollback_lines_to_serialize` ≤ `scroll_buffer_size`
- 如果 `scrollback_lines_to_serialize` > `scroll_buffer_size`，实际只会序列化所有可用的历史行

---

## 总结

- 序列化间隔：控制多久保存一次会话状态，默认 60 秒，不建议设为 0
- 序列化行数：控制每次保存多少行历史记录，默认 10000 行，每次是完整快照，重叠不影响功能